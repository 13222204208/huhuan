/*! 
 Build based on gin-vue-admin 
 Time : 1671085367000 */
var e=Object.defineProperty,l=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,i=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,o=(e,l,a)=>new Promise(((t,i)=>{var o=e=>{try{s(a.next(e))}catch(l){i(l)}},u=e=>{try{s(a.throw(e))}catch(l){i(l)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,u);s((a=a.apply(e,l)).next())}));import{o as u,r as s,p as r,q as d,t as n,v as m}from"../gva/gin-vue-admin-index.1671085367000.js";import{g as p}from"./gin-vue-admin-authority.16710853670002.js";import{C as c}from"./gin-vue-admin-index.167108536700011.js";import{_ as v}from"./gin-vue-admin-index.167108536700016.js";import{w as g}from"./gin-vue-admin-warningBar.1671085367000.js";import{r as h,w as y,i as f,o as b,j as w,k as I,q as _,t as k,H as V,v as x,A as N,e as C,d as z,R as j}from"./gin-vue-admin-vendor.1671085367000.js";/* empty css                                                                             */import"./gin-vue-admin-image.1671085367000.js";const U={class:"gva-table-box"},O={class:"gva-btn-list"},S=N("新增用户"),D=_("p",null,"确定要删除此用户吗",-1),P={style:{"text-align":"right","margin-top":"8px"}},q=N("取消"),T=N("确定"),B=N("删除"),E=N("编辑"),R=N("重置密码"),F={class:"gva-pagination"},J={style:{height:"60vh",overflow:"auto",padding:"0 12px"}},A=["src"],H={key:1,class:"header-img-box"},G={class:"dialog-footer"},K=N("取 消"),L=N("确 定"),M={name:"User"},Q=Object.assign(M,{setup(e){const N=h("/api"),M=(e,l)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const a={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};M(e.children,a.children),l.push(a)}else{const a={authorityId:e.authorityId,authorityName:e.authorityName};l.push(a)}}))},Q=h(1),W=h(0),X=h(10),Y=h([]),Z=e=>{X.value=e,ee()},$=e=>{Q.value=e,ee()},ee=()=>o(this,null,(function*(){const e=yield u({page:Q.value,pageSize:X.value});0===e.code&&(Y.value=e.data.list,W.value=e.data.total,Q.value=e.data.page,X.value=e.data.pageSize)}));y(Y,(()=>{ae()}));(()=>{o(this,null,(function*(){ee();const e=yield p({page:1,pageSize:999});ue(e.data.list)}))})();const le=e=>{C.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>o(this,null,(function*(){const l=yield s({ID:e.ID});0===l.code?z({type:"success",message:l.msg}):z({type:"error",message:l.msg})}))))},ae=()=>{Y.value&&Y.value.forEach((e=>{const l=e.authorities&&e.authorities.map((e=>e.authorityId));e.authorityIds=l}))},te=h(null),ie=()=>{te.value.open()},oe=h([]),ue=e=>{oe.value=[],M(e,oe.value)},se=e=>o(this,null,(function*(){0===(yield r({id:e.ID})).code&&(z.success("删除成功"),e.visible=!1,yield ee())})),re=h({username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[]}),de=h({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),ne=h(null),me=()=>o(this,null,(function*(){re.value.authorityId=re.value.authorityIds[0],ne.value.validate((e=>o(this,null,(function*(){if(e){const e=((e,o)=>{for(var u in o||(o={}))a.call(o,u)&&i(e,u,o[u]);if(l)for(var u of l(o))t.call(o,u)&&i(e,u,o[u]);return e})({},re.value);if("add"===ve.value){0===(yield d(e)).code&&(z({type:"success",message:"创建成功"}),yield ee(),ce())}if("edit"===ve.value){0===(yield n(e)).code&&(z({type:"success",message:"编辑成功"}),yield ee(),ce())}}}))))})),pe=h(!1),ce=()=>{ne.value.resetFields(),re.value.headerImg="",re.value.authorityIds=[],pe.value=!1},ve=h("add"),ge=()=>{ve.value="add",pe.value=!0},he=(e,l)=>o(this,null,(function*(){if(l)return;yield j();0===(yield m({ID:e.ID,authorityIds:e.authorityIds})).code&&z({type:"success",message:"角色设置成功"})}));return(e,l)=>{const a=f("el-button"),t=f("el-table-column"),i=f("el-cascader"),o=f("el-popover"),u=f("el-table"),s=f("el-pagination"),r=f("el-input"),d=f("el-form-item"),n=f("el-form"),m=f("el-dialog");return b(),w("div",null,[I(g,{title:"注：右上角头像下拉可切换角色"}),_("div",U,[_("div",O,[I(a,{size:"small",type:"primary",icon:"plus",onClick:ge},{default:k((()=>[S])),_:1})]),I(u,{data:Y.value,"row-key":"ID"},{default:k((()=>[I(t,{align:"left",label:"头像","min-width":"75"},{default:k((e=>[I(c,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),I(t,{align:"left",label:"ID","min-width":"50",prop:"ID"}),I(t,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),I(t,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),I(t,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),I(t,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),I(t,{align:"left",label:"用户角色","min-width":"200"},{default:k((e=>[I(i,{modelValue:e.row.authorityIds,"onUpdate:modelValue":l=>e.row.authorityIds=l,options:oe.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:l=>{he(e.row,l)},onRemoveTag:()=>{he(e.row,!1)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),I(t,{label:"操作","min-width":"250",fixed:"right"},{default:k((e=>[I(o,{visible:e.row.visible,"onUpdate:visible":l=>e.row.visible=l,placement:"top",width:"160"},{reference:k((()=>[I(a,{type:"text",icon:"delete",size:"small"},{default:k((()=>[B])),_:1})])),default:k((()=>[D,_("div",P,[I(a,{size:"small",type:"text",onClick:l=>e.row.visible=!1},{default:k((()=>[q])),_:2},1032,["onClick"]),I(a,{type:"primary",size:"small",onClick:l=>se(e.row)},{default:k((()=>[T])),_:2},1032,["onClick"])])])),_:2},1032,["visible","onUpdate:visible"]),I(a,{type:"text",icon:"edit",size:"small",onClick:l=>{return a=e.row,ve.value="edit",re.value=JSON.parse(JSON.stringify(a)),void(pe.value=!0);var a}},{default:k((()=>[E])),_:2},1032,["onClick"]),I(a,{type:"text",icon:"magic-stick",size:"small",onClick:l=>le(e.row)},{default:k((()=>[R])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),_("div",F,[I(s,{"current-page":Q.value,"page-size":X.value,"page-sizes":[10,30,50,100],total:W.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:$,onSizeChange:Z},null,8,["current-page","page-size","total"])])]),I(m,{modelValue:pe.value,"onUpdate:modelValue":l[6]||(l[6]=e=>pe.value=e),"custom-class":"user-dialog",title:"用户","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{footer:k((()=>[_("div",G,[I(a,{size:"small",onClick:ce},{default:k((()=>[K])),_:1}),I(a,{size:"small",type:"primary",onClick:me},{default:k((()=>[L])),_:1})])])),default:k((()=>[_("div",J,[I(n,{ref_key:"userForm",ref:ne,rules:de.value,model:re.value,"label-width":"80px"},{default:k((()=>["add"===ve.value?(b(),V(d,{key:0,label:"用户名",prop:"userName"},{default:k((()=>[I(r,{modelValue:re.value.userName,"onUpdate:modelValue":l[0]||(l[0]=e=>re.value.userName=e)},null,8,["modelValue"])])),_:1})):x("",!0),"add"===ve.value?(b(),V(d,{key:1,label:"密码",prop:"password"},{default:k((()=>[I(r,{modelValue:re.value.password,"onUpdate:modelValue":l[1]||(l[1]=e=>re.value.password=e)},null,8,["modelValue"])])),_:1})):x("",!0),I(d,{label:"昵称",prop:"nickName"},{default:k((()=>[I(r,{modelValue:re.value.nickName,"onUpdate:modelValue":l[2]||(l[2]=e=>re.value.nickName=e)},null,8,["modelValue"])])),_:1}),I(d,{label:"手机号",prop:"phone"},{default:k((()=>[I(r,{modelValue:re.value.phone,"onUpdate:modelValue":l[3]||(l[3]=e=>re.value.phone=e)},null,8,["modelValue"])])),_:1}),I(d,{label:"邮箱",prop:"email"},{default:k((()=>[I(r,{modelValue:re.value.email,"onUpdate:modelValue":l[4]||(l[4]=e=>re.value.email=e)},null,8,["modelValue"])])),_:1}),I(d,{label:"用户角色",prop:"authorityId"},{default:k((()=>[I(i,{modelValue:re.value.authorityIds,"onUpdate:modelValue":l[5]||(l[5]=e=>re.value.authorityIds=e),style:{width:"100%"},options:oe.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),I(d,{label:"头像","label-width":"80px"},{default:k((()=>[_("div",{style:{display:"inline-block"},onClick:ie},[re.value.headerImg?(b(),w("img",{key:0,class:"header-img-box",src:re.value.headerImg&&"http"!==re.value.headerImg.slice(0,4)?N.value+re.value.headerImg:re.value.headerImg},null,8,A)):(b(),w("div",H,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["modelValue"]),I(v,{ref_key:"chooseImg",ref:te,target:re.value,"target-key":"headerImg"},null,8,["target"])])}}});export{Q as default};

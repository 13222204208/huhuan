/*! 
 Build based on gin-vue-admin 
 Time : 1671085367000 */
var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,n=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a,l)=>new Promise(((t,n)=>{var r=e=>{try{s(l.next(e))}catch(a){n(a)}},o=e=>{try{s(l.throw(e))}catch(a){n(a)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);s((l=l.apply(e,a)).next())}));import{U as o,g as s,e as u}from"./gin-vue-admin-image.1671085367000.js";import{u as i}from"../gva/gin-vue-admin-index.1671085367000.js";import{r as m,i as c,o as p,j as d,k as v,t as g,x as f,A as y,d as b,H as h,q as j,L as x,C as w,J as k,e as C}from"./gin-vue-admin-vendor.1671085367000.js";import{w as z}from"./gin-vue-admin-warningBar.1671085367000.js";const O=y("普通上传"),U={name:"UploadCommon",methods:{}},_=Object.assign(U,{emits:["on-success"],setup(e,{emit:a}){const l=m("/api"),t=i(),n=m(!1),r=e=>{n.value=!0;const a="image/jpeg"===e.type,l="image/png"===e.type,t=e.size/1024/1024<.5;return a||l||(b.error("上传图片只能是 jpg或png 格式!"),n.value=!1),t||(b.error("未压缩未见上传图片大小不能超过 500KB，请使用压缩上传"),n.value=!1),(l||a)&&t},o=e=>{const{data:l}=e;l.file&&a("on-success",l.file.url)},s=()=>{b({type:"error",message:"上传失败"}),n.value=!1};return(e,a)=>{const n=c("el-button"),u=c("el-upload");return p(),d("div",null,[v(u,{action:`${l.value}/fileUploadAndDownload/upload`,"before-upload":r,headers:{"x-token":f(t).token},"on-error":s,"on-success":o,"show-file-list":!1,class:"upload-btn"},{default:g((()=>[v(n,{size:"small",type:"primary"},{default:g((()=>[O])),_:1})])),_:1},8,["action","headers"])])}}});const S={class:"gva-btn-list"},V=y("查询"),P={class:"media"},B={class:"header-img-box-list"},I={class:"header-img-box-list"},K=j("picture",null,null,-1),A=["onClick"],E={props:{target:{type:Object,default:null},targetKey:{type:String,default:""}},emits:["enterImg"],setup(e,{expose:i,emit:f}){const y=m(""),O=m(""),U=m({}),E=m(1),T=m(0),q=m(20),D=e=>{q.value=e,M()},F=e=>{E.value=e,M()},H=m(!1),J=m([]),L=m("/api/"),M=()=>r(this,null,(function*(){const e=yield s(((e,r)=>{for(var o in r||(r={}))l.call(r,o)&&n(e,o,r[o]);if(a)for(var o of a(r))t.call(r,o)&&n(e,o,r[o]);return e})({page:E.value,pageSize:q.value},U.value));0===e.code&&(J.value=e.data.list,T.value=e.data.total,E.value=e.data.page,q.value=e.data.pageSize,H.value=!0)})),$=e=>r(this,null,(function*(){C.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((a=>r(this,[a],(function*({value:a}){e.name=a;0===(yield u(e)).code&&(b({type:"success",message:"编辑成功!"}),M())})))).catch((()=>{b({type:"info",message:"取消修改"})}))}));return i({open:M}),(a,l)=>{const t=c("el-input"),n=c("el-form-item"),r=c("el-button"),s=c("el-form"),u=c("el-icon"),i=c("el-image"),m=c("el-pagination"),b=c("el-drawer");return p(),h(b,{modelValue:H.value,"onUpdate:modelValue":l[3]||(l[3]=e=>H.value=e),title:"媒体库",size:"650px"},{default:g((()=>[v(z,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),j("div",S,[v(_,{imageCommon:O.value,"onUpdate:imageCommon":l[0]||(l[0]=e=>O.value=e),class:"upload-btn-media-library",onOnSuccess:M},null,8,["imageCommon"]),v(o,{imageUrl:y.value,"onUpdate:imageUrl":l[1]||(l[1]=e=>y.value=e),"file-size":512,"max-w-h":1080,class:"upload-btn-media-library",onOnSuccess:M},null,8,["imageUrl"]),v(s,{ref:"searchForm",inline:!0,model:U.value},{default:g((()=>[v(n,{label:""},{default:g((()=>[v(t,{modelValue:U.value.keyword,"onUpdate:modelValue":l[2]||(l[2]=e=>U.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),v(n,null,{default:g((()=>[v(r,{size:"small",type:"primary",icon:"search",onClick:M},{default:g((()=>[V])),_:1})])),_:1})])),_:1},8,["model"])]),j("div",P,[(p(!0),d(k,null,x(J.value,((a,l)=>(p(),d("div",{key:l,class:"media-box"},[j("div",B,[(p(),h(i,{key:l,src:a.url&&"http"!==a.url.slice(0,4)?L.value+a.url:a.url,onClick:l=>{return t=a.url,n=e.target,r=e.targetKey,n&&r&&(n[r]=t),f("enterImg",t),void(H.value=!1);var t,n,r}},{error:g((()=>[j("div",I,[v(u,null,{default:g((()=>[K])),_:1})])])),_:2},1032,["src","onClick"]))]),j("div",{class:"img-title",onClick:e=>$(a)},w(a.name),9,A)])))),128))]),v(m,{"current-page":E.value,"page-size":q.value,total:T.value,style:{"justify-content":"center"},layout:"total, prev, pager, next, jumper",onCurrentChange:F,onSizeChange:D},null,8,["current-page","page-size","total"])])),_:1},8,["modelValue"])}}};export{E as _};

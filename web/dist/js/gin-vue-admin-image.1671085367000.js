/*! 
 Build based on gin-vue-admin 
 Time : 1671085367000 */
import{s as e,_ as t,u as a}from"../gva/gin-vue-admin-index.1671085367000.js";import{r as i,i as s,o,j as l,k as n,t as d,x as r,A as h,d as c}from"./gin-vue-admin-vendor.1671085367000.js";const u=t=>e({url:"/fileUploadAndDownload/getFileList",method:"post",data:t}),p=t=>e({url:"/fileUploadAndDownload/deleteFile",method:"post",data:t}),m=t=>e({url:"/fileUploadAndDownload/editFileName",method:"post",data:t});class f{constructor(e,t,a=1920){this.file=e,this.fileSize=t,this.maxWH=a}compress(){const e=this.file.type,t=this.file.size/1024;return new Promise((a=>{const i=new FileReader;i.readAsDataURL(this.file),i.onload=()=>{const s=document.createElement("canvas"),o=document.createElement("img");o.src=i.result,o.onload=()=>{const i=s.getContext("2d"),l=this.dWH(o.width,o.height,this.maxWH);s.width=l.width,s.height=l.height,i.clearRect(0,0,s.width,s.height),i.drawImage(o,0,0,s.width,s.height);const n=s.toDataURL(e,.9),d=this.fileSizeKB(n);d>this.fileSize&&console.log("图片尺寸太大!"+t+" >> "+d);const r=this.dataURLtoBlob(n,e),h=new File([r],this.file.name);a(h)}}}))}dWH(e,t,a){const i={width:e,height:t};return Math.max(e,t)>a?e>t?(i.width=a,i.height=Math.round(t*(a/e)),i):(i.height=a,i.width=Math.round(e*(a/t)),i):i}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const a=atob(e.split(",")[1]);let i=e.split(",")[0].split(":")[1].split(";")[0];const s=new ArrayBuffer(a.length),o=new Uint8Array(s);for(let l=0;l<a.length;l++)o[l]=a.charCodeAt(l);return t&&(i=t),new Blob([s],{type:i,lastModifiedDate:new Date})}}const g=h("压缩上传"),w={name:"UploadImage",methods:{}};var U=t(Object.assign(w,{props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:1920}},emits:["on-success"],setup(e,{emit:t}){const h=e,u=i("/api"),p=a(),m=e=>{const t="image/jpeg"===e.type,a="image/png"===e.type;if(!t&&!a)return c.error("上传头像图片只能是 jpg或png 格式!"),!1;const i=e.size/1024<h.fileSize;if(!i){return new f(e,h.fileSize,h.maxWH).compress()}return i},w=e=>{const{data:a}=e;a.file&&t("on-success",a.file.url)};return(e,t)=>{const a=s("el-button"),i=s("el-upload");return o(),l("div",null,[n(i,{action:`${u.value}/fileUploadAndDownload/upload`,headers:{"x-token":r(p).token},"show-file-list":!1,"on-success":w,"before-upload":m,multiple:!1},{default:d((()=>[n(a,{size:"small",type:"primary"},{default:d((()=>[g])),_:1})])),_:1},8,["action","headers"])])}}}),[["__scopeId","data-v-15c9badb"]]);export{U,p as d,m as e,u as g};

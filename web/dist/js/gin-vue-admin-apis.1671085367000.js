/*! 
 Build based on gin-vue-admin 
 Time : 1671085367000 */
var e=(e,a,t)=>new Promise(((s,o)=>{var r=e=>{try{i(t.next(e))}catch(a){o(a)}},n=e=>{try{i(t.throw(e))}catch(a){o(a)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,n);i((t=t.apply(e,a)).next())}));import{e as a}from"./gin-vue-admin-api.16710853670002.js";import{s as t}from"../gva/gin-vue-admin-index.1671085367000.js";import{r as s,i as o,o as r,j as n,q as i,k as l,t as d,A as u,d as c}from"./gin-vue-admin-vendor.1671085367000.js";const p={class:"clearflex"},h=u("确 定"),v={name:"Apis"},y=Object.assign(v,{props:{row:{default:function(){return{}},type:Object}},setup(u,{expose:v}){const y=u,m=s({children:"children",label:"description"}),f=s([]),g=s([]),b=s("");(()=>{e(this,null,(function*(){const e=(yield a()).data.apis;f.value=I(e);const s=yield(o={authorityId:y.row.authorityId},t({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:o}));var o;b.value=y.row.authorityId,g.value=[],s.data.paths&&s.data.paths.forEach((e=>{g.value.push("p:"+e.path+"m:"+e.method)}))}))})();const k=s(!1),x=()=>{k.value=!0},I=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const s in a){const e={ID:s,description:s+"组",children:a[s]};t.push(e)}return t},j=s(null),w=()=>e(this,null,(function*(){const e=j.value.getCheckedNodes(!0);var a=[];e&&e.forEach((e=>{var t={path:e.path,method:e.method};a.push(t)}));var s;0===(yield(s={authorityId:b.value,casbinInfos:a},t({url:"/casbin/updateCasbin",method:"post",data:s}))).code&&c({type:"success",message:"api设置成功"})}));return v({needConfirm:k,enterAndNext:()=>{w()}}),(e,a)=>{const t=o("el-button"),s=o("el-tree");return r(),n("div",null,[i("div",p,[l(t,{class:"fl-right",size:"small",type:"primary",onClick:w},{default:d((()=>[h])),_:1})]),l(s,{ref_key:"apiTree",ref:j,data:f.value,"default-checked-keys":g.value,props:m.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"",onCheck:x},null,8,["data","default-checked-keys","props"])])}}});export{y as default};

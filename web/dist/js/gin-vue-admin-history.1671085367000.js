/*! 
 Build based on gin-vue-admin 
 Time : 1671085367000 */
import{U as e,u as a,r as s,g as l,w as t,S as n,i as u,o,j as r,k as i,t as v,J as m,L as c,x as p,V as d,N as y,W as g,q as f,O as h,H as S,A as b,C as q}from"./gin-vue-admin-vendor.1671085367000.js";import{u as I,e as N}from"../gva/gin-vue-admin-index.1671085367000.js";const x={class:"router-history"},O={name:"HistoryComponent"},C=Object.assign(O,{setup(O){const C=e(),J=a(),k=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),w=s([]),V=s(""),E=s(!1),j=I(),L=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),P=s(0),T=s(0),A=s(!1),H=s(!1),R=s(""),U=l((()=>j.userInfo.authority.defaultRouter)),_=()=>{w.value=[{name:U.value,meta:{title:"首页"},query:{},params:{}}],J.push({name:U.value}),E.value=!1,sessionStorage.setItem("historys",JSON.stringify(w.value))},W=()=>{let e;const a=w.value.findIndex((a=>(k(a)===R.value&&(e=a),k(a)===R.value))),s=w.value.findIndex((e=>k(e)===V.value));w.value.splice(0,a),a>s&&J.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},X=()=>{let e;const a=w.value.findIndex((a=>(k(a)===R.value&&(e=a),k(a)===R.value))),s=w.value.findIndex((e=>k(e)===V.value));w.value.splice(a+1,w.value.length),a<s&&J.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},Y=()=>{let e;w.value=w.value.filter((a=>(k(a)===R.value&&(e=a),k(a)===R.value))),J.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},$=e=>{if(!w.value.some((a=>((e,a)=>{if(e.name!==a.name)return!1;for(const s in e.query)if(e.query[s]!==a.query[s])return!1;for(const s in e.params)if(e.params[s]!==a.params[s])return!1;return!0})(a,e)))){const a={};a.name=e.name,a.meta=e.meta,a.query=e.query,a.params=e.params,w.value.push(a)}window.sessionStorage.setItem("activeValue",k(e))},z=e=>{const a=e.instance.attrs.tab;J.push({name:a.name,query:a.query,params:a.params})},B=e=>{const a=w.value.findIndex((a=>k(a)===e));k(C)===e&&(1===w.value.length?J.push({name:U.value}):a<w.value.length-1?J.push({name:w.value[a+1].name,query:w.value[a+1].query,params:w.value[a+1].params}):J.push({name:w.value[a-1].name,query:w.value[a-1].query,params:w.value[a-1].params})),w.value.splice(a,1)};t(E,(()=>{E.value?document.body.addEventListener("click",(()=>{E.value=!1})):document.body.removeEventListener("click",(()=>{E.value=!1}))})),t(C,((e,a)=>{"Login"!==e.name&&(w.value=w.value.filter((e=>!e.meta.closeTab)),$(e),sessionStorage.setItem("historys",JSON.stringify(w.value)),V.value=window.sessionStorage.getItem("activeValue"),a&&e&&a.name===e.name&&N.emit("reload"))}));return(()=>{N.on("closeThisPage",(()=>{B(L(C))})),N.on("closeAllPage",(()=>{_()})),N.on("mobile",(e=>{H.value=e})),N.on("collapse",(e=>{A.value=e}));const e=[{name:U.value,meta:{title:"首页"},query:{},params:{}}];w.value=JSON.parse(sessionStorage.getItem("historys"))||e,window.sessionStorage.getItem("activeValue")?V.value=window.sessionStorage.getItem("activeValue"):V.value=k(C),$(C)})(),n((()=>{N.off("collapse"),N.off("mobile")})),(e,a)=>{const s=u("el-tab-pane"),l=u("el-tabs");return o(),r("div",x,[i(l,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),closable:!(1===w.value.length&&e.$route.name===p(U)),type:"card",onContextmenu:a[1]||(a[1]=d((e=>(e=>{if(1===w.value.length&&C.name===U.value)return!1;let a="";if(a="SPAN"===e.srcElement.nodeName?e.srcElement.offsetParent.id:e.srcElement.id,a){let s;E.value=!0,s=A.value?54:220,H.value&&(s=0),P.value=e.clientX-s,T.value=e.clientY+10,R.value=a.split("-")[1]}})(e)),["prevent"])),onTabClick:z,onTabRemove:B},{default:v((()=>[(o(!0),r(m,null,c(w.value,(e=>(o(),S(s,{key:L(e),label:e.meta.title,name:L(e),tab:e,class:"gva-tab"},{label:v((()=>[f("span",{style:h({color:V.value===L(e)?p(j).activeColor:"#333"})},[f("i",{class:"dot",style:h({backgroundColor:V.value===L(e)?p(j).activeColor:"#ddd"})},null,4),b(" "+q(e.meta.title),1)],4)])),_:2},1032,["label","name","tab"])))),128))])),_:1},8,["modelValue","closable"]),y(f("ul",{style:h({left:P.value+"px",top:T.value+"px"}),class:"contextmenu"},[f("li",{onClick:_},"关闭所有"),f("li",{onClick:W},"关闭左侧"),f("li",{onClick:X},"关闭右侧"),f("li",{onClick:Y},"关闭其他")],4),[[g,E.value]])])}}});export{C as default};

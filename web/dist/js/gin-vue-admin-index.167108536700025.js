/*! 
 Build based on gin-vue-admin 
 Time : 1671085367000 */
var e=(e,l,a)=>new Promise(((t,i)=>{var o=e=>{try{u(a.next(e))}catch(l){i(l)}},d=e=>{try{u(a.throw(e))}catch(l){i(l)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,d);u((a=a.apply(e,l)).next())}));import l from"./gin-vue-admin-fieldDialog.1671085367000.js";import a from"./gin-vue-admin-previewCodeDialg.1671085367000.js";import{a as t,b as i,t as o,c as d}from"./gin-vue-admin-stringFun.1671085367000.js";import{p as u,c as n,g as s,a as r,b as m,d as p}from"./gin-vue-admin-autoCode.1671085367000.js";import{g as c}from"./gin-vue-admin-dictionary.1671085367000.js";import{U as v,p as f,r as b,i as g,o as y,j as N,q as h,k as _,t as x,J as k,L as C,x as V,a2 as w,H as T,v as U,A as z,F as S,G as j,d as F,a3 as L}from"./gin-vue-admin-vendor.1671085367000.js";import{_ as J}from"../gva/gin-vue-admin-index.1671085367000.js";import"./gin-vue-admin-sysDictionary.1671085367000.js";import"./gin-vue-admin-warningBar.1671085367000.js";import"./gin-vue-admin-dictionary.16710853670002.js";const q=e=>(S("data-v-9a9c27fe"),e=e(),j(),e),A={class:"gva-search-box"},D={style:{fontSize:"16px",paddingLeft:"20px"}},O=z(" 点这里从现有数据库创建代码 "),E=z("使用此表创建"),P={class:"gva-search-box"},$=q((()=>h("div",null," 自动创建API ",-1))),B=q((()=>h("div",null," 自动移动文件 ",-1))),M={class:"gva-table-box"},R={class:"gva-btn-list"},X=z("新增Field"),I=z("编辑"),G=z("上移"),H=z("下移"),K=q((()=>h("p",null,"确定删除吗？",-1))),Q={style:{"text-align":"right","margin-top":"8px"}},W=z("取消"),Y=z("确定"),Z=z("删除"),ee={class:"gva-btn-list justify-content-flex-end auto-btn-list"},le=z("预览代码"),ae=z("生成代码"),te={class:"dialog-footer"},ie=z("取 消"),oe=z("确 定"),de={class:"previewCodeTool"},ue=q((()=>h("p",null,"操作栏：",-1))),ne=z("全选"),se=z("复制"),re={class:"dialog-footer",style:{"padding-top":"14px","padding-right":"14px"}},me=z("确 定"),pe={name:"AutoCode"};var ce=J(Object.assign(pe,{setup(z){const S={fieldName:"",fieldDesc:"",fieldType:"",dataType:"",fieldJson:"",columnName:"",dataTypeLong:"",comment:"",fieldSearchType:"",dictType:""},j=v(),J=f([]),q=b({}),pe=b({dbName:"",tableName:""}),ce=b([]),ve=b([]),fe=b(""),be=b({}),ge=b({structName:"",tableName:"",packageName:"",abbreviation:"",description:"",autoCreateApiToSql:!1,autoMoveFile:!1,fields:[]}),ye=b({structName:[{required:!0,message:"请输入结构体名称",trigger:"blur"}],abbreviation:[{required:!0,message:"请输入结构体简称",trigger:"blur"}],description:[{required:!0,message:"请输入结构体描述",trigger:"blur"}],packageName:[{required:!0,message:"文件名称：sysXxxxXxxx",trigger:"blur"}]}),Ne=b({}),he=b({}),_e=b(!1),xe=b(!1),ke=b(null),Ce=()=>{ke.value.selectText()},Ve=()=>{ke.value.copy()},we=e=>{_e.value=!0,e?(fe.value="edit",he.value=JSON.parse(JSON.stringify(e)),Ne.value=e):(fe.value="add",Ne.value=JSON.parse(JSON.stringify(S)))},Te=L(),Ue=()=>{Te.refs.fieldDialogNode.fieldDialogFrom.validate((e=>{if(!e)return!1;Ne.value.fieldName=i(Ne.value.fieldName),"add"===fe.value&&ge.value.fields.push(Ne.value),_e.value=!1}))},ze=()=>{"edit"===fe.value&&(Ne.value=he.value),_e.value=!1},Se=b(null),je=l=>e(this,null,(function*(){return ge.value.fields.length<=0?(F({type:"error",message:"请填写至少一个field"}),!1):ge.value.fields.some((e=>e.fieldName===ge.value.structName))?(F({type:"error",message:"存在与结构体同名的字段"}),!1):void Se.value.validate((a=>e(this,null,(function*(){var e;if(!a)return!1;for(const l in ge.value)"string"==typeof ge.value[l]&&(ge.value[l]=ge.value[l].trim());if(ge.value.structName=i(ge.value.structName),ge.value.tableName&&(ge.value.tableName=ge.value.tableName.replace(" ","")),ge.value.structName===ge.value.abbreviation)return F({type:"error",message:"structName和struct简称不能相同"}),!1;if(ge.value.humpPackageName=o(ge.value.packageName),l){const e=yield u(ge.value);q.value=e.data.autoCode,xe.value=!0}else{const l=yield n(ge.value);if("false"===(null==(e=l.headers)?void 0:e.success))return;if(ge.value.autoMoveFile)return void F({type:"success",message:"自动化代码创建成功，自动移动成功"});F({type:"success",message:"自动化代码创建成功，正在下载"});const a=new Blob([l]),t="ginvueadmin.zip";if("download"in document.createElement("a")){const e=window.URL.createObjectURL(a),l=document.createElement("a");l.style.display="none",l.href=e,l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(e)}else window.navigator.msSaveBlob(a,t)}}))))})),Fe=()=>e(this,null,(function*(){const e=yield m();0===e.code&&(ce.value=e.data.dbs)})),Le=()=>e(this,null,(function*(){const e=yield s({dbName:pe.value.dbName});0===e.code&&(ve.value=e.data.tables),pe.value.tableName=""})),Je=()=>e(this,null,(function*(){const e=["id","created_at","updated_at","deleted_at"],l=yield r(pe.value);if(0===l.code){const a=d(pe.value.tableName);ge.value.structName=i(a),ge.value.tableName=pe.value.tableName,ge.value.packageName=a,ge.value.abbreviation=a,ge.value.description=a+"表",ge.value.autoCreateApiToSql=!0,ge.value.fields=[],l.data.columns&&l.data.columns.forEach((l=>{if(!e.some((e=>e===l.columnName))){const e=d(l.columnName);ge.value.fields.push({fieldName:i(e),fieldDesc:l.columnComment||e+"字段",fieldType:be.value[l.dataType],dataType:l.dataType,fieldJson:e,dataTypeLong:l.dataTypeLong&&l.dataTypeLong.split(",")[0],columnName:l.columnName,comment:l.columnComment,fieldSearchType:"",dictType:""})}}))}})),qe=()=>e(this,null,(function*(){["string","int","bool","float64","time.Time"].forEach((l=>e(this,null,(function*(){const e=yield c(l);e&&e.forEach((e=>{be.value[e.label]=l}))}))))})),Ae=l=>e(this,null,(function*(){const e=yield p({id:Number(l)});0===e.code&&(ge.value=JSON.parse(e.data.meta))}));return(()=>{Fe(),qe();const e=j.params.id;e&&Ae(e)})(),(e,i)=>{const o=g("pointer"),d=g("el-icon"),u=g("el-option"),n=g("el-select"),s=g("el-form-item"),r=g("el-button"),m=g("el-form"),p=g("el-collapse-item"),c=g("el-collapse"),v=g("el-input"),f=g("el-tooltip"),b=g("el-checkbox"),z=g("el-table-column"),S=g("el-popover"),j=g("el-table"),F=g("el-dialog");return y(),N("div",null,[h("div",A,[_(c,{modelValue:V(J),"onUpdate:modelValue":i[2]||(i[2]=e=>w(J)?J.value=e:J=e),style:{"margin-bottom":"12px"}},{default:x((()=>[_(p,{name:"1"},{title:x((()=>[h("div",D,[O,_(d,{class:"header-icon"},{default:x((()=>[_(o)])),_:1})])])),default:x((()=>[_(m,{ref:"getTableForm",style:{"margin-top":"24px"},inline:!0,model:pe.value,"label-width":"120px"},{default:x((()=>[_(s,{label:"数据库名",prop:"structName"},{default:x((()=>[_(n,{modelValue:pe.value.dbName,"onUpdate:modelValue":i[0]||(i[0]=e=>pe.value.dbName=e),filterable:"",placeholder:"请选择数据库",onChange:Le},{default:x((()=>[(y(!0),N(k,null,C(ce.value,(e=>(y(),T(u,{key:e.database,label:e.database,value:e.database},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),_(s,{label:"表名",prop:"structName"},{default:x((()=>[_(n,{modelValue:pe.value.tableName,"onUpdate:modelValue":i[1]||(i[1]=e=>pe.value.tableName=e),disabled:!pe.value.dbName,filterable:"",placeholder:"请选择表"},{default:x((()=>[(y(!0),N(k,null,C(ve.value,(e=>(y(),T(u,{key:e.tableName,label:e.tableName,value:e.tableName},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),_(s,null,{default:x((()=>[_(r,{size:"small",type:"primary",onClick:Je},{default:x((()=>[E])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])]),h("div",P,[_(m,{ref_key:"autoCodeForm",ref:Se,rules:ye.value,model:ge.value,"label-width":"120px",inline:!0},{default:x((()=>[_(s,{label:"Struct名称",prop:"structName"},{default:x((()=>[_(v,{modelValue:ge.value.structName,"onUpdate:modelValue":i[3]||(i[3]=e=>ge.value.structName=e),placeholder:"首字母自动转换大写"},null,8,["modelValue"])])),_:1}),_(s,{label:"TableName",prop:"tableName"},{default:x((()=>[_(v,{modelValue:ge.value.tableName,"onUpdate:modelValue":i[4]||(i[4]=e=>ge.value.tableName=e),placeholder:"指定表名（非必填）"},null,8,["modelValue"])])),_:1}),_(s,{label:"Struct简称",prop:"abbreviation"},{default:x((()=>[_(v,{modelValue:ge.value.abbreviation,"onUpdate:modelValue":i[5]||(i[5]=e=>ge.value.abbreviation=e),placeholder:"简称会作为入参对象名和路由group"},null,8,["modelValue"])])),_:1}),_(s,{label:"Struct中文名称",prop:"description"},{default:x((()=>[_(v,{modelValue:ge.value.description,"onUpdate:modelValue":i[6]||(i[6]=e=>ge.value.description=e),placeholder:"中文描述作为自动api描述"},null,8,["modelValue"])])),_:1}),_(s,{label:"文件名称",prop:"packageName"},{default:x((()=>[_(v,{modelValue:ge.value.packageName,"onUpdate:modelValue":i[7]||(i[7]=e=>ge.value.packageName=e),placeholder:"生成文件的默认名称(建议为驼峰格式,首字母小写,如sysXxxXxxx)",onBlur:i[8]||(i[8]=e=>{var l,a;(l=ge.value)[a="packageName"]=t(l[a])})},null,8,["modelValue"])])),_:1}),_(s,null,{label:x((()=>[_(f,{content:"注：把自动生成的API注册进数据库",placement:"bottom",effect:"light"},{default:x((()=>[$])),_:1})])),default:x((()=>[_(b,{modelValue:ge.value.autoCreateApiToSql,"onUpdate:modelValue":i[9]||(i[9]=e=>ge.value.autoCreateApiToSql=e)},null,8,["modelValue"])])),_:1}),_(s,null,{label:x((()=>[_(f,{content:"注：自动迁移生成的文件到ymal配置的对应位置",placement:"bottom",effect:"light"},{default:x((()=>[B])),_:1})])),default:x((()=>[_(b,{modelValue:ge.value.autoMoveFile,"onUpdate:modelValue":i[10]||(i[10]=e=>ge.value.autoMoveFile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])]),h("div",M,[h("div",R,[_(r,{size:"small",type:"primary",onClick:i[11]||(i[11]=e=>we())},{default:x((()=>[X])),_:1})]),_(j,{data:ge.value.fields},{default:x((()=>[_(z,{align:"left",type:"index",label:"序列",width:"100"}),_(z,{align:"left",prop:"fieldName",label:"Field名"}),_(z,{align:"left",prop:"fieldDesc",label:"中文名"}),_(z,{align:"left",prop:"fieldJson",label:"FieldJson"}),_(z,{align:"left",prop:"fieldType",label:"Field数据类型",width:"130"}),_(z,{align:"left",prop:"dataTypeLong",label:"数据库字段长度",width:"130"}),_(z,{align:"left",prop:"columnName",label:"数据库字段",width:"130"}),_(z,{align:"left",prop:"comment",label:"数据库字段描述",width:"130"}),_(z,{align:"left",prop:"fieldSearchType",label:"搜索条件",width:"130"}),_(z,{align:"left",prop:"dictType",label:"字典",width:"130"}),_(z,{align:"left",label:"操作",width:"300"},{default:x((e=>[_(r,{size:"small",type:"text",icon:"edit",onClick:l=>we(e.row)},{default:x((()=>[I])),_:2},1032,["onClick"]),_(r,{size:"small",type:"text",disabled:0===e.$index,onClick:l=>(e=>{if(0===e)return;const l=ge.value.fields[e-1];ge.value.fields.splice(e-1,1),ge.value.fields.splice(e,0,l)})(e.$index)},{default:x((()=>[G])),_:2},1032,["disabled","onClick"]),_(r,{size:"small",type:"text",disabled:e.$index+1===ge.value.fields.length,onClick:l=>(e=>{if(e===ge.value.fields.length-1)return;const l=ge.value.fields[e+1];ge.value.fields.splice(e+1,1),ge.value.fields.splice(e,0,l)})(e.$index)},{default:x((()=>[H])),_:2},1032,["disabled","onClick"]),_(S,{visible:e.row.visible,"onUpdate:visible":l=>e.row.visible=l,placement:"top"},{reference:x((()=>[_(r,{size:"small",type:"text",icon:"delete",onClick:l=>e.row.visible=!0},{default:x((()=>[Z])),_:2},1032,["onClick"])])),default:x((()=>[K,h("div",Q,[_(r,{size:"small",type:"text",onClick:l=>e.row.visible=!1},{default:x((()=>[W])),_:2},1032,["onClick"]),_(r,{type:"primary",size:"small",onClick:l=>{return a=e.$index,void ge.value.fields.splice(a,1);var a}},{default:x((()=>[Y])),_:2},1032,["onClick"])])])),_:2},1032,["visible","onUpdate:visible"])])),_:1})])),_:1},8,["data"]),h("div",ee,[_(r,{size:"small",type:"primary",onClick:i[12]||(i[12]=e=>je(!0))},{default:x((()=>[le])),_:1}),_(r,{size:"small",type:"primary",onClick:i[13]||(i[13]=e=>je(!1))},{default:x((()=>[ae])),_:1})])]),_(F,{modelValue:_e.value,"onUpdate:modelValue":i[14]||(i[14]=e=>_e.value=e),title:"组件内容"},{footer:x((()=>[h("div",te,[_(r,{size:"small",onClick:ze},{default:x((()=>[ie])),_:1}),_(r,{size:"small",type:"primary",onClick:Ue},{default:x((()=>[oe])),_:1})])])),default:x((()=>[_e.value?(y(),T(l,{key:0,ref:"fieldDialogNode","dialog-middle":Ne.value},null,8,["dialog-middle"])):U("",!0)])),_:1},8,["modelValue"]),_(F,{modelValue:xe.value,"onUpdate:modelValue":i[16]||(i[16]=e=>xe.value=e)},{title:x((()=>[h("div",de,[ue,_(r,{size:"small",type:"primary",onClick:Ce},{default:x((()=>[ne])),_:1}),_(r,{size:"small",type:"primary",onClick:Ve},{default:x((()=>[se])),_:1})])])),footer:x((()=>[h("div",re,[_(r,{size:"small",type:"primary",onClick:i[15]||(i[15]=e=>xe.value=!1)},{default:x((()=>[me])),_:1})])])),default:x((()=>[xe.value?(y(),T(a,{key:0,ref_key:"previewNode",ref:ke,"preview-code":q.value},null,8,["preview-code"])):U("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-9a9c27fe"]]);export{ce as default};
